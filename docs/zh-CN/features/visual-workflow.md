# 可视化工作流

使用拖放式编辑器创建自动化流程。串联脚本、触发其他工作流，并自动化您的开发流程。

## 概览

可视化工作流让您无需编写脚本即可创建多步骤自动化。适用于：

- 构建和部署管线
- 测试序列
- 发布流程
- 日常开发例行工作

<!-- TODO: Add screenshot of workflow editor -->

## 创建工作流

### 新建工作流

1. 导航至**工作流**标签
2. 点击**新建工作流**
3. 为您的工作流命名
4. 开始添加节点

### 画布

工作流编辑器是一个可视化画布，您可以：

- **拖动**侧边栏的节点
- **连接**节点与边缘
- **配置**每个节点的设置

<!-- TODO: Add gif of dragging and connecting nodes -->

## 节点类型

### 脚本节点

运行 shell 命令或 npm 脚本。

**配置：**
- **命令**：要运行的命令
- **工作目录**：运行命令的位置（可选）
- **超时**：最大运行时间（可选）

<!-- TODO: Add screenshot of script node configuration -->

### 触发工作流节点

触发另一个工作流，实现嵌套自动化。

**配置：**
- **工作流**：选择要触发的工作流
- **等待完成**：是否等待后再继续

> 注意：PackageFlow 会检测循环引用并防止无限循环。

## 连接节点

### 创建连接

1. 从节点的**输出端点**（右侧）点击并拖动
2. 放到另一个节点的**输入端点**（左侧）
3. 连接创建完成

### 并行运行

将多个节点连接到同一个输出以并行运行：

```
        ┌─→ [单元测试]
[构建]──┼─→ [E2E 测试]
        └─→ [集成测试]
```

### 顺序运行

将节点串联以顺序运行：

```
[构建] → [测试] → [部署]
```

<!-- TODO: Add screenshot showing parallel vs sequential execution -->

## 失败策略

配置节点失败时的处理方式：

### 失败时停止（默认）

任何节点失败时，工作流立即停止。

### 失败时继续

即使一个节点失败，工作流仍继续运行剩余节点。

<!-- TODO: Add screenshot of failure strategy selector -->

## 运行工作流

### 手动触发

1. 从列表选择工作流
2. 点击**运行工作流**
3. 实时观看运行过程

### 运行可视化

运行期间：
- **运行中节点**：动画边框
- **已完成节点**：绿色勾选
- **失败节点**：红色 X 与错误详情

<!-- TODO: Add gif of workflow execution with node states -->

## 运行历史

查看过去的工作流运行：

1. 选择工作流
2. 点击面板中的**历史**
3. 查看所有过去的运行，包含：
   - 时间戳
   - 持续时间
   - 状态（成功/失败）
   - 每个节点的日志

<!-- TODO: Add screenshot of execution history panel -->

## 工作流模板

### 保存为模板

将常用的工作流保存为模板：

1. 创建并配置您的工作流
2. 点击**保存为模板**
3. 给它一个名称和描述
4. 模板现在可供日后使用

### 使用模板

1. 点击**新建工作流**
2. 选择**从模板**
3. 选择模板
4. 根据需要自定义

<!-- TODO: Add screenshot of template selection dialog -->

## 环境变量

为工作流中的所有节点设置环境变量：

1. 打开工作流设置
2. 添加键值对
3. 变量可用于所有脚本节点

## 提示

1. **从简单开始**：从 2-3 个节点开始，需要时再扩展
2. **使用模板**：将常见模式保存为模板
3. **检查历史**：查看过去的运行以调试失败
4. **清楚命名节点**：使用描述性名称以便于调试
5. **逐步测试**：每添加一个节点后运行工作流

## 示例

### 构建和部署

```
[安装依赖] → [构建] → [运行测试] → [部署到 Staging]
```

### 日常开发

```
[拉取最新] → [安装] → [启动开发服务器]
```

### 发布管线

```
[运行测试] → [构建] → [版本号递增] → [创建标签] → [部署]
```
